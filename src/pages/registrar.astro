---
import Layout from "../layouts/Layout.astro";
import Image from "astro/components/Image.astro";
import image from '../assets/image.jpg';
---

<script>
    import { register } from '../scripts/Supabase.js';

    (window as any).register = register
</script>

<Layout>
    <section class="container grid">
        <div>
            <Image src={image} alt="" style="width: 100%"/>
        </div>
        <form 
        hx-boost="false"
        x-data="{
            email: '',
            password: '',
            checkPassword: '',
            feedback: '',
            async submit(){
                try{
                    if(this.password !== this.checkPassword) throw new Error('Senhas não são iguais');
                    const user = await register(this.email, this.password)
                    console.log(user)
                }catch(err){
                    console.log(err)
                    this.feedback = err.message
                }
            }
        }" 
        @submit.prevent="submit">
            <article>
                <h1>Criar conta</h1>
                <div class="alert" x-show="feedback">
                    <ul>
                        <li x-text="feedback"></li>
                    </ul>
                    <div class="close" @click="feedback = ''">X</div>
                </div>
                <label>
                    Email: <br>
                    <input type="email" x-model="email">
                </label>
                <label>
                    Senha: <br>
                    <input type="password" x-model="password">
                </label>
                <label>
                    Repetir Senha: <br>
                    <input type="password" x-model="checkPassword">
                </label>
                <button>Criar</button>
            </article>
        </form>
    </section>
</Layout>

<style>
    button {
        width: 100%;
    }

    .alert {
        background-color: rgba(255, 0, 0, 0.2);
        border-radius: 0.2rem;
        padding: 1rem;
        position: relative;
        margin-bottom: 2rem;
    }

    .alert ul  {
        color: rgb(255, 0, 0);
        margin: 0;
        padding: 0;
        padding-left: 1rem;
    }

    .alert .close {
        position: absolute;
        right: 0.5rem;
        top: 0.5rem;
        border-radius: 99999px;
        background-color: rgba(220, 0, 0, 0.7);
        color: white;
        font-weight: bold;
        height: 1.2rem;
        width: 1.2rem;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        padding-top: 0.1rem;
        font-size: 0.8rem;
        cursor: pointer;
    }

    .alert li {
        margin: 0;
        padding: 0;
    }
</style>